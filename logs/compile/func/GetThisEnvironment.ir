def GetThisEnvironment(
): EnvironmentRecord {
  let env = @EXECUTION_STACK[0].LexicalEnvironment
  loop[repeat] true {
    method-call %0 = env->HasThisBinding()
    let exists = %0
    if (= exists true) {
      return env
    } else {}
    let outer = env.OuterEnv
    assert (! (= outer null))
    env = outer
  }
}